# Application Insights Availability Data

Test results are stored in the Log Analytics Workspace attached to the Application Insights instance. The Tables that are visible from the Application Inside interface are different when viewed in the attached Log Analytics interface. Differences explained [here](https://docs.microsoft.com/en-us/azure/azure-monitor/app/convert-classic-resource#table-structure)

The availability test results are stored in the LAW table **AppAvailabilityResults**. Schema can be found [here](https://docs.microsoft.com/en-us/azure/azure-monitor/app/convert-classic-resource#appavailabilityresults)

## Example Test Outputs

The following results were generated from tests configured in the Application Insight interface.

### Valid Test

| Field      | Value                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Name       | valid test                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Success    | true                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Message    | Passed                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Location   | Japan East                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| DurationMs | 500                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Properties | ``` { "WebtestLocationId": "emea-ch-zrh-edge", "FullTestResultAvailable": "false", "SourceId": "sid://040d848c-dbb1-4241-9c04-e60fd460e791.visualstudio.com/applications/gvb-mss-appinisghts/features/test1-gvb-mss-appinisghts/locations/emea-ch-zrh-edge", "_MS.altIds": "a17bfb3f153ac0c8,88c010b643af4f41","WebtestArmResourceName":"test1-gvb-mss-appinisghts","SyntheticMonitorId":"default_test1-gvb-mss-appinisghts_emea-ch-zrh-edge"} ``` |

### Invalid Status Code Test

| Field      | Value                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Name       | invalid status code test                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Success    | false                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Message    | '200 - OK' does not match the expected status '400 - BadRequest'.                                                                                                                                                                                                                                                                                                                                                                                  |
| Location   | Japan East                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| DurationMs | 500                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Properties | ``` { "WebtestLocationId": "emea-ch-zrh-edge", "FullTestResultAvailable": "false", "SourceId": "sid://040d848c-dbb1-4241-9c04-e60fd460e791.visualstudio.com/applications/gvb-mss-appinisghts/features/test1-gvb-mss-appinisghts/locations/emea-ch-zrh-edge", "_MS.altIds": "a17bfb3f153ac0c8,88c010b643af4f41","WebtestArmResourceName":"test1-gvb-mss-appinisghts","SyntheticMonitorId":"default_test1-gvb-mss-appinisghts_emea-ch-zrh-edge"} ``` |


### Soon Expiring Certificate Test


| Field       | Value                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ----------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Name        | soon expiring certificate test                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Success     | false                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Message     | Certificate will expire in 46 day(s). Configured certificate remaining lifetime check is 90 day(s).                                                                                                                                                                                                                                                                                                                                                |
| Location    | Japan East                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| DurationMs  | 500                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Properties: | ``` { "WebtestLocationId": "emea-ch-zrh-edge", "FullTestResultAvailable": "false", "SourceId": "sid://040d848c-dbb1-4241-9c04-e60fd460e791.visualstudio.com/applications/gvb-mss-appinisghts/features/test1-gvb-mss-appinisghts/locations/emea-ch-zrh-edge", "_MS.altIds": "a17bfb3f153ac0c8,88c010b643af4f41","WebtestArmResourceName":"test1-gvb-mss-appinisghts","SyntheticMonitorId":"default_test1-gvb-mss-appinisghts_emea-ch-zrh-edge"} ``` |

### Expired Certificate Test

| Field       | Value                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ----------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Name        | expired certificate test                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Success     | false                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Message     | < Certificate Details >                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Location    | Japan East                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| DurationMs  | 500                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Properties: | ``` { "WebtestLocationId": "emea-ch-zrh-edge", "FullTestResultAvailable": "false", "SourceId": "sid://040d848c-dbb1-4241-9c04-e60fd460e791.visualstudio.com/applications/gvb-mss-appinisghts/features/test1-gvb-mss-appinisghts/locations/emea-ch-zrh-edge", "_MS.altIds": "a17bfb3f153ac0c8,88c010b643af4f41","WebtestArmResourceName":"test1-gvb-mss-appinisghts","SyntheticMonitorId":"default_test1-gvb-mss-appinisghts_emea-ch-zrh-edge"} ``` |

### Revoked Certificate Test

| Field       | Value                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ----------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Name        | revoked certificate test                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Success     | false                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Message     | < Certificate Details >                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Location    | Japan East                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| DurationMs  | 500                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Properties: | ``` { "WebtestLocationId": "emea-ch-zrh-edge", "FullTestResultAvailable": "false", "SourceId": "sid://040d848c-dbb1-4241-9c04-e60fd460e791.visualstudio.com/applications/gvb-mss-appinisghts/features/test1-gvb-mss-appinisghts/locations/emea-ch-zrh-edge", "_MS.altIds": "a17bfb3f153ac0c8,88c010b643af4f41","WebtestArmResourceName":"test1-gvb-mss-appinisghts","SyntheticMonitorId":"default_test1-gvb-mss-appinisghts_emea-ch-zrh-edge"} ``` |

# Proposed Monitor Output

The monitor output should be as much in line with the App Insights internal tests output. As the `Properties` field content is not really relevant for custom monitors we could store additional test/result data, proposal included in table below.   

| Field       | Value                                                                    |
| ----------- | ------------------------------------------------------------------------ |
| Name        | <info.name>-<item.name> (from Postman collection definition)             |
| Success     | `true/false`  Same logic as App Insights internal tests                  |
| Message     | Handle content equally as App Insights internal tests                    |
| Location    | container ip address / resource id ?                                     |
| DurationMs  | 500                                                                      |
| Properties: | ``` { "url": <url>, "status_code": <response.status_code>,  .... ? } ``` |

